<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 日本冬之旅 | V11.3 Fixed</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Zen+Old+Mincho:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Noto Sans TC"', 'sans-serif'], serif: ['"Zen Old Mincho"', 'serif'] },
                    colors: {
                        'ice-100': '#F0F9FF', 'ice-200': '#E0F2FE', 'ice-500': '#0EA5E9', 'ice-600': '#0284C7',
                        'rose-100': '#FFF1F2', 'rose-200': '#FECDD3', 'rose-500': '#F43F5E',
                        'navy': '#1E293B', 'silver': '#94A3B8'
                    },
                    boxShadow: { 'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.1)' }
                }
            }
        }
    </script>

    <style>
        body {
            background: linear-gradient(135deg, #F0F9FF 0%, #FFFFFF 40%, #FFF1F2 100%);
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }
        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(16px);
            border-top: 1px solid rgba(255, 255, 255, 0.5);
        }
        .nav-item.active { color: #0EA5E9; transform: translateY(-2px); }
        .nav-item.active i { background: #E0F2FE; padding: 10px; border-radius: 50%; box-shadow: 0 4px 12px rgba(14, 165, 233, 0.2); }
        
        /* Calculator Buttons */
        .calc-btn {
            background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.8); transition: all 0.1s;
        }
        .calc-btn:active { background: rgba(224, 242, 254, 0.9); transform: scale(0.96); }

        /* Animations */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .slide-up-enter-active { animation: slideUp 0.3s ease-out; }
        .slide-up-leave-active { animation: slideUp 0.3s ease-in reverse; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .scan-line {
            width: 100%; height: 2px; background: #0EA5E9; box-shadow: 0 0 4px #0EA5E9;
            position: absolute; top: 0; left: 0; animation: scanning 1.5s infinite linear;
        }
        @keyframes scanning { 0% {top: 0;} 100% {top: 100%;} }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Snow Animation */
        .snow-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1.5" fill="%23fff" opacity="0.8"/><circle cx="20" cy="80" r="1" fill="%23fff" opacity="0.6"/><circle cx="80" cy="20" r="2" fill="%23fff" opacity="0.9"/></svg>');
            background-size: 200px 200px;
            opacity: 0.8;
            pointer-events: none;
            animation: snowfall 10s linear infinite;
            z-index: 10;
        }
        @keyframes snowfall { from { background-position: 0 0; } to { background-position: 100px 200px; } }

        .note-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .note-content.expanded { max-height: 200px; }
    </style>
</head>
<body class="text-slate-700 font-sans">

<div id="app">
    <!-- Header (Sticky) -->
    <header class="fixed top-0 w-full z-50 glass-card px-5 py-3 shadow-sm transition-all duration-300">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="font-serif text-lg font-bold text-navy tracking-wider">2026 冬之旅</h1>
                <p class="text-[9px] text-slate-500 tracking-widest uppercase">Kyoto & Nagoya 11 Days</p>
            </div>
            <div class="text-right flex gap-3">
                <div><div class="text-[9px] text-slate-400 font-bold">TW</div><div class="font-mono text-xs font-bold text-slate-500">{{ twTime }}</div></div>
                <div class="border-l border-slate-200 pl-3">
                    <div class="text-[9px] text-ice-500 font-bold">JP</div><div class="font-mono text-sm font-bold text-navy">{{ jpTime }}</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="min-h-screen pb-24 pt-16">
        
        <!-- PLAN TAB -->
        <div v-if="currentTab === 'plan'">
            
            <!-- Hero Section -->
            <div class="relative w-full h-64 bg-slate-200 rounded-b-[3rem] overflow-hidden shadow-lg mb-4">
                <img src="image.png" onerror="this.src='https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=800&auto=format&fit=crop'" class="w-full h-full object-cover">
                <div class="snow-layer"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-navy/60 to-transparent"></div>
                <div class="absolute bottom-6 left-6 text-white">
                    <div class="text-xs font-light tracking-widest mb-1 opacity-90">JAPAN WINTER TRIP</div>
                    <div class="text-2xl font-serif font-bold">古都與雪國的邂逅</div>
                </div>
            </div>

            <div class="px-4">
                <!-- Date Selector (Sticky below Hero/Header) -->
                <div class="sticky top-[60px] z-40 bg-white/95 backdrop-blur-md rounded-xl shadow-sm mb-5 mx-1 border border-white/50">
                    <div class="flex overflow-x-auto hide-scrollbar space-x-2 p-2 snap-x">
                        <div v-for="(day, index) in days" :key="index" 
                             @click="selectedDayIndex = index"
                             class="snap-center flex-shrink-0 w-[52px] h-[64px] rounded-lg flex flex-col items-center justify-center cursor-pointer transition-all duration-300 border"
                             :class="selectedDayIndex === index ? 'bg-navy text-white border-navy shadow-md scale-105' : 'bg-transparent text-slate-400 border-transparent hover:bg-slate-50'">
                            <span class="text-xs font-bold uppercase">{{ day.weekday }}</span>
                            <span class="text-xs font-medium opacity-80">{{ day.date }}</span>
                        </div>
                    </div>
                </div>

                <!-- Weather Widget -->
                <div class="mb-6 bg-gradient-to-r from-ice-100 to-white border border-ice-200 rounded-2xl p-4 flex justify-between items-center shadow-sm">
                    <div class="flex items-center space-x-4 text-navy">
                        <i :class="getWeatherIcon(currentDayData.weather)" class="text-3xl text-ice-500 drop-shadow-sm"></i>
                        <div>
                            <div class="text-2xl font-bold leading-none">{{ currentDayData.temp }}°C</div>
                            <div class="text-[10px] text-slate-500 mt-1 font-bold"><i class="fa-solid fa-location-dot mr-1"></i>{{ currentDayData.loc }}</div>
                        </div>
                    </div>
                    <div class="text-right text-xs text-slate-600">
                        <div class="font-bold mb-1 px-2 py-0.5 bg-white rounded-full inline-block shadow-sm text-ice-600">{{ getWeatherDesc(currentDayData.weather) }}</div>
                        <div class="mt-1 text-slate-400">
                            <i class="fa-solid fa-shoe-prints mr-1"></i> {{ currentDayData.steps }} 步
                        </div>
                    </div>
                </div>

                <!-- Itinerary Details -->
                <div class="space-y-5 relative pl-4 border-l-2 border-slate-100 ml-2 pb-10">
                    <div v-for="(item, idx) in currentDayData.details" :key="idx" class="relative group">
                        <div class="absolute -left-[23px] top-4 w-3.5 h-3.5 rounded-full border-2 border-white shadow-sm transition-colors duration-300"
                             :class="getCategoryColor(item.type)"></div>
                        
                        <div class="glass-card rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-300 border border-white/60">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-mono text-[10px] text-slate-500 bg-slate-100 px-2 py-0.5 rounded-md font-bold">{{ item.time }}</span>
                                <button v-if="item.info || item.mapKeyword" @click="openInfoModal(item)" class="text-[10px] bg-ice-50 text-ice-600 px-2 py-1 rounded-full border border-ice-100 hover:bg-ice-100 transition-colors flex items-center">
                                    <i class="fa-solid fa-book-open mr-1"></i> 介紹
                                </button>
                            </div>
                            
                            <h4 class="font-bold text-slate-800 text-base mb-1">{{ item.text }}</h4>
                            
                            <!-- Tags -->
                            <div v-if="item.tags" class="flex flex-wrap gap-1 mb-2">
                                <span v-for="tag in item.tags" class="text-[9px] px-1.5 py-0.5 rounded bg-slate-50 text-slate-400 border border-slate-100">#{{ tag }}</span>
                            </div>

                            <!-- Note with Toggle -->
                            <div v-if="item.note" class="text-xs text-orange-600 bg-orange-50 p-2 rounded-lg mt-2 border border-orange-100 flex items-start gap-2">
                                <i class="fa-solid fa-circle-exclamation mt-0.5 flex-shrink-0"></i>
                                <div>
                                    <span :class="{'line-clamp-1': !item.expanded}">{{ item.note }}</span>
                                    <button v-if="item.note.length > 20" @click="item.expanded = !item.expanded" class="text-[10px] text-orange-400 underline ml-1 font-bold">
                                        {{ item.expanded ? '收合' : '更多' }}
                                    </button>
                                </div>
                            </div>

                            <!-- Shopping Alert -->
                            <div v-if="item.buy" class="mt-2 bg-rose-50 border border-rose-100 rounded-lg p-2 flex gap-2 items-center">
                                <i class="fa-solid fa-gift text-rose-400 text-xs"></i>
                                <span class="text-xs text-slate-700 font-bold">必買：{{ item.buy }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CHECKLIST TAB -->
        <div v-if="currentTab === 'checklist'" class="px-4">
            <div class="flex p-1 bg-white rounded-xl mb-6 shadow-sm border border-slate-100 sticky top-20 z-20">
                <button v-for="tab in ['tasks', 'packing', 'shopping']" 
                        @click="activeCheckTab = tab"
                        class="flex-1 py-2 text-xs font-bold rounded-lg transition-all"
                        :class="activeCheckTab === tab ? 'bg-ice-500 text-white shadow-md' : 'text-slate-400 hover:text-slate-600'">
                    {{ tab === 'tasks' ? '待辦票券' : tab === 'packing' ? '行李清單' : '採購清單' }}
                </button>
            </div>

            <!-- Tasks -->
            <div v-if="activeCheckTab === 'tasks'" class="space-y-3">
                <div v-for="(t, i) in ticketTasks" :key="i" 
                     class="bg-white p-4 rounded-xl border border-slate-100 flex justify-between items-center shadow-sm">
                    <div>
                        <div class="font-bold text-sm text-slate-700">
                            {{ t.title }} 
                            <span v-if="t.urgent" class="bg-rose-500 text-white text-[9px] px-1.5 py-0.5 rounded ml-1 animate-pulse">急</span>
                        </div>
                        <div class="text-xs text-ice-500 mt-1 font-bold"><i class="fa-regular fa-clock"></i> {{ t.deadline }}</div>
                        <div v-if="t.note" class="text-[10px] text-slate-400 mt-0.5">{{ t.note }}</div>
                    </div>
                    <input type="checkbox" v-model="checkData['t-'+i]" @change="saveCheckData" class="w-5 h-5 accent-ice-500 cursor-pointer">
                </div>
            </div>

            <!-- Packing -->
            <div v-if="activeCheckTab === 'packing'" class="space-y-4">
                <div v-for="(cat, i) in packingList" :key="i" class="glass-card rounded-xl p-4 border border-slate-100">
                    <div class="text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded mb-3 inline-block">{{ cat.category }}</div>
                    <div class="space-y-2">
                        <label v-for="(item, j) in cat.items" :key="item.id" class="flex items-center gap-3 p-2 hover:bg-slate-50 rounded-lg cursor-pointer transition-colors">
                            <input type="checkbox" v-model="checkData[item.id]" @change="saveCheckData" class="w-4 h-4 accent-slate-500 rounded">
                            <span class="text-sm transition-all duration-300" :class="checkData[item.id] ? 'line-through text-slate-300' : 'text-slate-600'">{{ item.text }}</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Shopping -->
            <div v-if="activeCheckTab === 'shopping'" class="grid grid-cols-1 gap-3">
                <label v-for="(s, i) in shoppingList" :key="i" 
                       class="bg-white p-3 rounded-xl border border-slate-100 flex items-center gap-3 shadow-sm hover:shadow-md transition-shadow cursor-pointer">
                    <input type="checkbox" v-model="checkData['s-'+i]" @change="saveCheckData" class="w-4 h-4 accent-rose-400 rounded">
                    <div>
                        <div class="text-sm font-medium transition-all" :class="checkData['s-'+i] ? 'line-through text-slate-300' : 'text-slate-700'">{{ s.item }}</div>
                        <div class="text-[10px] text-slate-400 mt-0.5"><i class="fa-solid fa-location-dot text-rose-300"></i> {{ s.loc }}</div>
                    </div>
                </label>
            </div>
        </div>

        <!-- WALLET TAB -->
        <div v-if="currentTab === 'wallet'" class="px-4">
            <div class="glass-card rounded-2xl p-6 shadow-lg bg-gradient-to-br from-navy to-slate-700 text-white relative overflow-hidden mb-6 mt-4">
                <div class="absolute -right-5 -top-5 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
                <div class="relative z-10 flex justify-between items-end">
                    <div>
                        <p class="text-[10px] text-slate-300 mb-1 tracking-wider uppercase">Total Expense (TWD)</p>
                        <h2 class="text-4xl font-mono font-bold tracking-tight">NT$ {{ formatNumber(totalTWD) }}</h2>
                    </div>
                    <div class="text-right">
                        <div class="text-[10px] text-slate-300 mb-1">匯率 Rate</div>
                        <input type="number" step="0.001" v-model="currentRate" @change="saveWalletData" class="w-16 bg-white/10 rounded px-2 py-1 text-center text-sm text-white border border-white/20 outline-none focus:bg-white/20 transition-all">
                    </div>
                </div>
            </div>

            <div class="space-y-5">
                <div v-if="walletData.length === 0" class="text-center text-slate-400 py-12 text-sm flex flex-col items-center">
                    <i class="fa-solid fa-wallet text-4xl mb-3 opacity-20"></i>
                    尚未新增任何消費<br>點擊右下角 + 開始記帳
                </div>
                
                <div v-for="(dateGroup, date) in groupedExpenses" :key="date" class="animate-fade-in">
                    <div class="flex justify-between items-center px-2 mb-2">
                        <span class="text-xs font-bold text-slate-600 bg-slate-100 px-2 py-1 rounded-md">{{ date }}</span>
                        <span class="text-xs font-bold text-slate-400">NT$ {{ formatNumber(dateGroup.total) }}</span>
                    </div>
                    <div class="space-y-2">
                        <div v-for="item in dateGroup.items" :key="item.id" class="bg-white p-3 rounded-xl shadow-sm border border-slate-50 flex items-center gap-3">
                            <div v-if="item.img" class="w-12 h-12 rounded-lg bg-slate-100 shrink-0 overflow-hidden cursor-pointer border border-slate-100" @click="showImg(item.img)">
                                <img :src="item.img" class="w-full h-full object-cover">
                            </div>
                            <div v-else class="w-12 h-12 rounded-lg bg-slate-50 flex items-center justify-center text-slate-300 shrink-0">
                                <i class="fa-solid fa-bag-shopping"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="font-bold text-slate-700 text-sm truncate">{{ item.name }}</div>
                                <div class="text-[10px] text-slate-400 font-mono">{{ item.currency === 'JPY' ? 'JPY' : 'TWD' }}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-mono font-bold text-slate-700">{{ item.currency==='JPY'?'¥':'NT$' }}{{ formatNumber(item.amount) }}</div>
                            </div>
                            <button @click="delExpense(item.id)" class="text-slate-300 hover:text-rose-400 px-2 transition-colors"><i class="fa-solid fa-trash text-xs"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- JAPANESE TAB (RESTORED COMPLETE CONTENT) -->
        <div v-if="currentTab === 'japanese'" class="px-4 space-y-4 pt-4">
            <div class="bg-yellow-50 border border-yellow-100 p-3 rounded-xl flex gap-3 items-center text-xs text-yellow-800 shadow-sm">
                <div class="bg-yellow-100 p-2 rounded-full"><i class="fa-solid fa-volume-high"></i></div>
                <span>點擊句子即可播放發音 (需開啟手機音量)</span>
            </div>
            
            <div v-for="(cat, i) in jpPhrases" :key="i" class="glass-card rounded-xl overflow-hidden shadow-sm border border-white/60">
                <div @click="cat.open = !cat.open" class="p-4 flex justify-between items-center cursor-pointer transition-colors hover:bg-white/50" :class="cat.color + '/20'">
                    <span class="font-bold text-sm" :class="cat.color.replace('bg-', 'text-').replace('50', '600')">{{ cat.cat }}</span>
                    <i class="fa-solid fa-chevron-down text-xs opacity-50 transition-transform duration-300" :class="cat.open ? 'rotate-180' : ''"></i>
                </div>
                <div v-show="cat.open" class="divide-y divide-slate-100 bg-white/80">
                    <div v-for="(p, j) in cat.list" :key="j" @click="speak(p.jp)" class="p-3 active:bg-ice-100 transition-colors cursor-pointer hover:bg-slate-50 group">
                        <div class="text-sm font-bold text-slate-700 mb-1">{{ p.tw }}</div>
                        <div class="text-xs text-slate-400 font-mono mb-0.5">{{ p.ro }}</div>
                        <div class="text-xs text-ice-500 font-bold flex justify-between items-center">
                            {{ p.jp }} <i class="fa-solid fa-volume-low opacity-0 group-hover:opacity-100 transition-opacity text-slate-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- INFO TAB -->
        <div v-if="currentTab === 'info'" class="px-4 space-y-4 pt-4">
            <div class="glass-card rounded-2xl p-5 shadow-sm border border-white/60">
                <h4 class="font-bold text-slate-800 mb-3 text-sm flex items-center gap-2"><i class="fa-solid fa-passport text-navy"></i> 2026 入境與規定</h4>
                <ul class="text-xs text-slate-600 space-y-2.5 list-disc pl-4 leading-relaxed">
                    <li><strong>Visit Japan Web (VJW)</strong>：入境審查與海關申報已整合為單一 QR Code。請務必在出發前完成登錄並截圖保存。</li>
                    <li><strong>預先審查 (Pre-clearance)</strong>：部分航班可於出發地完成部分審查，縮短抵日時間。</li>
                    <li><strong>免稅新制</strong>：截至目前多數店舖仍維持「消費滿 5000 日圓(未稅)直接免稅」。需出示護照或 VJW 免稅 QR Code。</li>
                    <li><strong>違禁品</strong>：肉類製品 (含真空包裝)、生鮮蔬果、植物種子嚴禁攜帶。</li>
                </ul>
            </div>
            <div class="glass-card rounded-2xl p-5 border-l-4 border-rose-400 shadow-sm">
                <h4 class="font-bold text-slate-700 mb-3 text-sm">緊急聯絡卡</h4>
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <a href="tel:110" class="bg-rose-50 p-3 rounded-xl text-center border border-rose-100 text-rose-500 font-bold hover:bg-rose-100 transition-colors">110 警察</a>
                    <a href="tel:119" class="bg-rose-50 p-3 rounded-xl text-center border border-rose-100 text-rose-500 font-bold hover:bg-rose-100 transition-colors">119 救護</a>
                </div>
                <a href="tel:+81-3-3280-7111" class="block bg-slate-50 p-3 rounded-xl text-center border border-slate-100 hover:bg-slate-100 transition-colors">
                    <div class="text-slate-700 font-bold text-sm">台北駐日經濟文化代表處</div>
                    <div class="text-xs text-slate-500 mt-1 font-mono">03-3280-7111 (急難救助)</div>
                </a>
            </div>
        </div>

    </main>

    <!-- Floating Add Button (Wallet) -->
    <transition name="fade">
        <button v-if="currentTab === 'wallet'" @click="openCalcModal" class="fixed bottom-24 right-5 bg-navy text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center text-2xl z-40 hover:bg-slate-700 transition-all active:scale-90 ring-4 ring-white/30">
            <i class="fa-solid fa-plus"></i>
        </button>
    </transition>

    <!-- Calculator Modal -->
    <transition name="slide-up">
        <div v-if="showCalcModal" class="fixed inset-0 z-50">
            <div class="absolute inset-0 bg-navy/60 backdrop-blur-sm" @click="closeCalcModal"></div>
            <div class="absolute bottom-0 w-full bg-white rounded-t-3xl shadow-2xl p-5 pb-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-slate-700 flex items-center gap-2"><i class="fa-solid fa-calculator text-ice-500"></i> 新增支出</h3>
                    <button @click="closeCalcModal" class="text-slate-400 p-2"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                
                <div class="space-y-3 mb-3">
                    <div class="flex gap-2">
                        <input type="date" v-model="calcDate" class="bg-slate-100 rounded-xl px-3 py-2 text-sm w-1/3 outline-none font-medium text-slate-600">
                        <input type="text" v-model="calcName" placeholder="品項 (或拍照辨識)" class="bg-slate-100 rounded-xl px-4 py-2 text-sm flex-1 outline-none transition-all focus:ring-2 focus:ring-ice-200">
                    </div>
                    <label class="w-full bg-ice-50 border border-ice-200 text-ice-600 rounded-xl py-3 flex items-center justify-center cursor-pointer hover:bg-ice-100 transition-colors gap-2 font-bold text-sm">
                        <i class="fa-solid fa-camera"></i> 拍照/上傳收據
                        <input type="file" accept="image/*" class="hidden" @change="handlePhoto">
                    </label>
                    <div v-if="isScanning" class="absolute top-20 left-5 right-5 h-16 bg-navy/80 rounded-xl z-20 flex items-center justify-center text-white gap-2 shadow-lg">
                        <i class="fa-solid fa-circle-notch fa-spin"></i> 正在辨識收據...
                    </div>
                    <div class="relative mt-2">
                        <input type="text" v-model="calcExpr" readonly placeholder="0" class="w-full text-right text-4xl font-mono font-bold text-navy bg-transparent border-b border-slate-200 pb-2 outline-none">
                        <div class="absolute left-0 bottom-2 flex gap-2">
                            <button @click="toggleCurrency" class="text-xs font-bold bg-navy text-white px-3 py-1 rounded shadow-sm hover:bg-slate-700 transition-colors">{{ currType }}</button>
                        </div>
                    </div>
                    <div v-if="tempImg" class="h-24 w-full relative rounded-lg overflow-hidden border border-slate-200 mt-2 shadow-sm">
                        <img :src="tempImg" class="w-full h-full object-cover opacity-90">
                        <button @click="clearPhoto" class="absolute top-2 right-2 bg-rose-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs shadow-md hover:bg-rose-600 transition-colors"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                </div>

                <div class="grid grid-cols-4 gap-2 h-64">
                    <button @click="pk('C')" class="calc-btn text-rose-400 font-bold">C</button>
                    <button @click="pk('/')" class="calc-btn text-ice-500"><i class="fa-solid fa-divide"></i></button>
                    <button @click="pk('*')" class="calc-btn text-ice-500"><i class="fa-solid fa-xmark"></i></button>
                    <button @click="pk('back')" class="calc-btn text-slate-400"><i class="fa-solid fa-delete-left"></i></button>
                    <button @click="pk('7')" class="calc-btn text-xl font-medium text-slate-700">7</button>
                    <button @click="pk('8')" class="calc-btn text-xl font-medium text-slate-700">8</button>
                    <button @click="pk('9')" class="calc-btn text-xl font-medium text-slate-700">9</button>
                    <button @click="pk('-')" class="calc-btn text-ice-500"><i class="fa-solid fa-minus"></i></button>
                    <button @click="pk('4')" class="calc-btn text-xl font-medium text-slate-700">4</button>
                    <button @click="pk('5')" class="calc-btn text-xl font-medium text-slate-700">5</button>
                    <button @click="pk('6')" class="calc-btn text-xl font-medium text-slate-700">6</button>
                    <button @click="pk('+')" class="calc-btn text-ice-500"><i class="fa-solid fa-plus"></i></button>
                    <button @click="pk('1')" class="calc-btn text-xl font-medium text-slate-700">1</button>
                    <button @click="pk('2')" class="calc-btn text-xl font-medium text-slate-700">2</button>
                    <button @click="pk('3')" class="calc-btn text-xl font-medium text-slate-700">3</button>
                    <button @click="submitExpense" class="calc-btn row-span-2 bg-navy text-white text-xl rounded-xl shadow-lg border-0 hover:bg-slate-700 active:scale-95 transition-all">OK</button>
                    <button @click="pk('0')" class="calc-btn col-span-2 text-xl font-medium text-slate-700 rounded-bl-xl">0</button>
                    <button @click="pk('.')" class="calc-btn text-xl font-medium text-slate-700">.</button>
                </div>
            </div>
        </div>
    </transition>

    <!-- Info Modal (Itinerary) -->
    <transition name="slide-up">
        <div v-if="showInfoModal" class="fixed inset-0 z-[60]">
            <div class="absolute inset-0 bg-navy/60 backdrop-blur-sm" @click="showInfoModal = false"></div>
            <div class="absolute bottom-0 w-full md:bottom-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:max-w-md bg-white md:rounded-2xl rounded-t-2xl p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-serif font-bold text-navy">{{ modalData.title }}</h3>
                    <button @click="showInfoModal = false" class="p-2 bg-slate-100 rounded-full hover:bg-slate-200 transition-colors"><i class="fa-solid fa-xmark text-slate-500"></i></button>
                </div>
                <div class="space-y-4 mb-4 text-sm text-slate-600 leading-relaxed bg-slate-50 p-4 rounded-xl border-l-4 border-ice-500">
                    {{ modalData.content }}
                </div>
                <div v-if="modalData.mapKeyword" class="w-full h-48 bg-slate-100 rounded-xl overflow-hidden shadow-inner border border-slate-200">
                    <iframe width="100%" height="100%" frameborder="0" style="border:0" :src="'https://maps.google.com/maps?q=' + encodeURIComponent(modalData.mapKeyword) + '&z=15&output=embed'"></iframe>
                </div>
                <button onclick="window.open('https://maps.google.com/maps?q=' + encodeURIComponent(modalData.mapKeyword), '_blank')" class="w-full bg-ice-500 text-white py-3 rounded-xl font-bold text-sm hover:bg-ice-600 transition-colors shadow-md mt-2 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-location-arrow"></i> 開啟 Google Maps 導航
                </button>
            </div>
        </div>
    </transition>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-0 w-full glass-nav pb-safe z-30">
        <div class="flex justify-around items-center h-16 px-2">
            <button v-for="tab in ['plan', 'checklist', 'wallet', 'japanese', 'info']" 
                    @click="currentTab = tab" 
                    :class="['nav-item flex flex-col items-center gap-1 w-14 transition-transform duration-200', currentTab === tab ? 'active scale-105' : 'text-slate-400 hover:text-slate-600']">
                <i :class="getNavIcon(tab)" class="text-lg"></i>
                <span class="text-[10px]">{{ getNavLabel(tab) }}</span>
            </button>
        </div>
    </nav>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- STATE ---
            const currentTab = ref('plan');
            const twTime = ref('--:--');
            const jpTime = ref('--:--');
            const selectedDayIndex = ref(0);
            const activeCheckTab = ref('tasks');
            const showCalcModal = ref(false);
            const showInfoModal = ref(false);
            const isScanning = ref(false);
            const modalData = ref({ title: '', content: '', mapKeyword: '' });

            // Wallet State
            const walletData = ref(JSON.parse(localStorage.getItem('trip_wallet_vue')) || []);
            const currentRate = ref(parseFloat(localStorage.getItem('trip_rate_vue')) || 0.21);
            const calcDate = ref(new Date().toISOString().split('T')[0]);
            const calcName = ref('');
            const calcExpr = ref('');
            const currType = ref('JPY');
            const tempImg = ref(null);

            // Checklist State
            const checkData = ref(JSON.parse(localStorage.getItem('trip_check_vue')) || {});

            // --- STATIC DATA ---
            const days = [
                { date: '1/31', weekday: '六', loc: '京都', weather: 'cloudy', temp: '5', steps: '8,000' },
                { date: '2/1', weekday: '日', loc: '京都', weather: 'cloudy', temp: '4', steps: '18,000' },
                { date: '2/2', weekday: '一', loc: '神戶', weather: 'sunny', temp: '6', steps: '16,000' },
                { date: '2/3', weekday: '二', loc: '京都', weather: 'cloudy', temp: '5', steps: '20,000' },
                { date: '2/4', weekday: '三', loc: '名古屋', weather: 'rain', temp: '8', steps: '12,000' },
                { date: '2/5', weekday: '四', loc: '岐阜', weather: 'snow', temp: '-2', steps: '10,000' },
                { date: '2/6', weekday: '五', loc: '名古屋', weather: 'sunny', temp: '7', steps: '14,000' },
                { date: '2/7', weekday: '六', loc: '三重', weather: 'sunny', temp: '8', steps: '15,000' },
                { date: '2/8', weekday: '日', loc: '名古屋', weather: 'cloudy', temp: '6', steps: '10,000' },
                { date: '2/9', weekday: '一', loc: '愛知', weather: 'sunny', temp: '7', steps: '15,000' },
                { date: '2/10', weekday: '二', loc: '返程', weather: 'cloudy', temp: '6', steps: '6,000' },
            ];

            const itineraryDetails = [
                // Day 1
                [{ time: "09:20", text: "TPE 起飛 (JX822)", type: "transport", info: "台灣桃園機場第一航廈。", expanded: false }, { time: "12:50", text: "抵達關西機場 (KIX)", type: "transport", info: "抵達後辦理入境VJW。預計耗時 1-1.5 小時。", expanded: false }, { time: "14:14", text: "HARUKA 前往京都", type: "transport", info: "建議搭乘 14:14 或 14:44 班次。車程約 80 分鐘。", expanded: false }, { time: "16:30", text: "京都大神宮", type: "spot", tags: ["姻緣"], buy: "巫女御守", info: "四條河原町鬧區中的神社。御守販售處 17:00 關閉。", mapKeyword: "京都大神宮", expanded: false }, { time: "18:00", text: "迪士尼商店", type: "shop", tags: ["購物"], buy: "Zootopia周邊", info: "四條河原町店。二樓有較多大型玩偶。", mapKeyword: "Disney Store Kyoto Kawaramachi", expanded: false }],
                // Day 2
                [{ time: "09:00", text: "大原三千院", type: "spot", tags: ["庭園","苔蘚"], note: "山區寒冷", info: "苔蘚庭園有清園，交通約1小時", mapKeyword: "Sanzen-in Temple", expanded: false }, { time: "13:00", text: "下鴨神社", type: "spot", tags: ["世界遺產"], buy: "蕾絲御守", mapKeyword: "Shimogamo Shrine", expanded: false }, { time: "16:30", text: "靈光殿天滿宮", type: "spot", tags: ["必勝"], buy: "天下無敵御守", mapKeyword: "Reikoden Temmangu", expanded: false }],
                // Day 3
                [{ time: "10:30", text: "北野異人館 & 天滿神社", type: "spot", tags: ["洋風"], buy: "風月堂法蘭酥", info: "俯瞰神戶市景", mapKeyword: "Kitano Tenmangu Shrine Kobe", expanded: false }, { time: "15:00", text: "舞子六神社", type: "spot", tags: ["海景"], buy: "海洋御守", info: "明石大橋正下方絕景", mapKeyword: "Maiko Roku Shrine", expanded: false }],
                // Day 4
                [{ time: "08:30", text: "伏見稻荷大社", type: "spot", tags: ["健行"], note: "千本鳥居", mapKeyword: "Fushimi Inari Taisha", expanded: false }, { time: "12:00", text: "勝林寺", type: "spot", tags: ["花手水"], buy: "透明御朱印", mapKeyword: "Shorinji Temple", expanded: false }, { time: "16:00", text: "平等寺", type: "spot", tags: ["貓咪"], buy: "六貓御守", mapKeyword: "Inabado", expanded: false }],
                // Day 5
                [{ time: "09:30", text: "新幹線前往名古屋", type: "transport", info: "約35-50分鐘", expanded: false }, { time: "13:00", text: "大須商店街 & 錦鯱神社", type: "spot", tags: ["御朱印"], buy: "華麗御朱印", mapKeyword: "Kinshachi Shrine", expanded: false }, { time: "16:00", text: "榮商圈 & 綠洲21", type: "spot", mapKeyword: "Oasis 21", expanded: false }],
                // Day 6
                [{ time: "08:00", text: "巴士前往白川鄉", type: "transport", note: "務必預約", info: "車程約2.5-3小時", expanded: false }, { time: "11:00", text: "合掌村散策", type: "spot", tags: ["世界遺產"], buy: "紫蘇最中", mapKeyword: "Shirakawa-go", expanded: false }, { time: "14:00", text: "城山展望台", type: "spot", info: "拍攝全景最佳點", mapKeyword: "Shiroyama Viewpoint", expanded: false }],
                // Day 7
                [{ time: "09:30", text: "城山八幡宮", type: "spot", tags: ["戀愛"], buy: "戀愛御守", mapKeyword: "Shiroyama Hachimangu", expanded: false }, { time: "15:00", text: "Parco / 松坂屋", type: "shop", info: "市區購物", mapKeyword: "Nagoya Parco", expanded: false }],
                // Day 8
                [{ time: "08:30", text: "近鐵前往伊勢", type: "transport", expanded: false }, { time: "10:30", text: "伊勢神宮 (內宮)", type: "spot", tags: ["聖地"], info: "日本最高地位神社", mapKeyword: "Ise Jingu Naiku", expanded: false }, { time: "12:30", text: "托福橫丁", type: "food", buy: "伊勢布丁", mapKeyword: "Okage Yokocho", expanded: false }],
                // Day 9
                [{ time: "10:00", text: "熱田神宮", type: "spot", tags: ["三神器"], buy: "白鳥守", mapKeyword: "Atsuta Jingu", expanded: false }, { time: "14:00", text: "扭蛋/採買", type: "shop", info: "名古屋車站周邊", mapKeyword: "Nagoya Station", expanded: false }],
                // Day 10
                [{ time: "09:00", text: "愛地球博記念公園", type: "transport", note: "週二休園", mapKeyword: "Ghibli Park", expanded: false }, { time: "10:00", text: "吉卜力大倉庫", type: "spot", tags: ["必訪"], buy: "限定周邊", expanded: false }, { time: "13:00", text: "魔女之谷", type: "spot", tags: ["霍爾"], info: "真實還原霍爾城堡，Premium券可入內", mapKeyword: "Ghibli Park Witch Valley", expanded: false }],
                // Day 11
                [{ time: "11:00", text: "最後衝刺", type: "shop", buy: "7-11費南雪", expanded: false }, { time: "16:30", text: "Flight of Dreams", type: "spot", buy: "蝦餅", mapKeyword: "Flight of Dreams", expanded: false }, { time: "19:40", text: "JX839 返台", type: "transport", expanded: false }]
            ];

            const ticketTasks = [
                { title: "吉卜力門票 (12/10搶)", deadline: "出發前2個月", urgent: true },
                { title: "合掌村巴士", deadline: "出發前1個月", urgent: true },
                { title: "HARUKA 車票", deadline: "出發前2週" },
                { title: "近鐵特急 (伊勢)", deadline: "當週" },
                { title: "Visit Japan Web", deadline: "出發前3天", note: "入境+海關QR" }
            ];

            const packingList = [
                { category: "證件財物", items: [{text:"護照 (效期6個月+)", id:"p1"}, {text:"日幣現金 & 信用卡", id:"p2"}, {text:"VJW QR Code 截圖", id:"p3"}] },
                { category: "電子產品", items: [{text:"網卡 / eSIM 設定", id:"e1"}, {text:"行動電源 (隨身)", id:"e2"}, {text:"充電器 & 線材", id:"e3"}] },
                { category: "冬季衣物", items: [{text:"防風防水厚外套", id:"c1"}, {text:"發熱衣 & 發熱褲", id:"c2"}, {text:"防滑防水靴 (合掌村)", id:"c3"}, {text:"毛帽、圍巾、手套", id:"c4"}] },
                { category: "藥品雜物", items: [{text:"常備藥", id:"d1"}, {text:"護唇膏/護手霜", id:"d2"}, {text:"牙刷牙膏", id:"d3"}, {text:"輕量摺疊傘", id:"d4"}] }
            ];

            const shoppingList = [
                { id: "s1", item: "吉卜力大倉庫限定品", loc: "愛知" }, { id: "s2", item: "霍爾移動城堡周邊", loc: "愛知" },
                { id: "s3", item: "京都大神宮巫女御守", loc: "京都" }, { id: "s4", item: "平等寺六貓御守", loc: "京都" },
                { id: "s5", item: "伊勢布丁 / 赤福", loc: "三重" }, { id: "s6", item: "7-11 銀之葡萄費南雪", loc: "名古屋" },
                { id: "s7", item: "勝林寺 透明御朱印", loc: "京都" }, { id: "s8", item: "蝦餅 (機場)", loc: "名古屋" }
            ];

            // --- RESTORED COMPLETE JAPANESE PHRASES (V11.2) ---
            const jpPhrases = [
                { 
                    cat: "購物 (Shopping)", color: "bg-rose-50 text-rose-800", open: false,
                    list: [
                        {tw:"這是期間限定的嗎？", jp:"これは期間限定ですか？", ro:"Kore wa kikan gentei desu ka?"}, 
                        {tw:"可以算便宜一點嗎？", jp:"少し安くしてもらえませんか？", ro:"Sukoshi yasuku shite moraemasen ka?"}, 
                        {tw:"哪個是人氣第一名？", jp:"一番人気はどれですか？", ro:"Ichiban ninki wa dore desu ka?"}, 
                        {tw:"請幫我包裝成禮物。", jp:"プレゼント用に包んでください。", ro:"Purezento you ni tsutsunde kudasai."},
                        {tw:"這個多少錢？", jp:"これはいくらですか？", ro:"Kore wa ikura desu ka?"}, 
                        {tw:"有新的嗎？", jp:"新しいのはありますか？", ro:"Atarashii no wa arimasu ka?"}
                    ] 
                },
                { 
                    cat: "餐飲 (Dining)", color: "bg-orange-50 text-orange-800", open: false,
                    list: [
                        {tw:"有推薦的菜單嗎？", jp:"おすすめのメニューはありますか？", ro:"Osusume no menyu wa arimasu ka?"}, 
                        {tw:"請給我水。", jp:"お水をください。", ro:"Omizu o kudasai."}, 
                        {tw:"我要結帳。", jp:"お会計をお願いします。", ro:"Okaikei o onegaishimasu."}, 
                        {tw:"我不吃牛肉。", jp:"牛肉は食べられません。", ro:"Gyuniku wa taberaremasen."},
                        {tw:"請給我菜單。", jp:"メニューをください。", ro:"Menyu o kudasai."}
                    ] 
                },
                { 
                    cat: "交通 (Transport)", color: "bg-emerald-50 text-emerald-800", open: false,
                    list: [
                        {tw:"請問車站在哪裡？", jp:"駅はどこですか？", ro:"Eki wa doko desu ka?"}, 
                        {tw:"這班車會到名古屋嗎？", jp:"これは名古屋に行きますか？", ro:"Kore wa Nagoya ni ikimasu ka?"}, 
                        {tw:"我想去這裡(指地圖)。", jp:"ここに行きたいです。", ro:"Koko ni ikitai desu."}, 
                        {tw:"可以給我一張路線圖嗎？", jp:"路線図をもらえますか？", ro:"Rosen-zu o moraemasu ka?"}
                    ] 
                },
                { 
                    cat: "便利商店 (Konbini)", color: "bg-sky-50 text-sky-800", open: false,
                    list: [
                        {tw:"我不需要袋子。", jp:"袋はいりません。", ro:"Fukuro wa irimasen."}, 
                        {tw:"請給我兩雙筷子。", jp:"お箸を2膳つけてください。", ro:"Ohashi o nizen tsukete kudasai."}, 
                        {tw:"我要用 Suica 付款。", jp:"Suicaで支払います。", ro:"Suica de shiharaimasu."}, 
                        {tw:"請幫我微波加熱。", jp:"温めてください。", ro:"Atatamete kudasai."}
                    ] 
                },
                { 
                    cat: "緊急 (Emergency)", color: "bg-red-50 text-red-800", open: false,
                    list: [
                        {tw:"請問廁所在哪裡？", jp:"トイレはどこですか？", ro:"Toire wa doko desu ka?"}, 
                        {tw:"我的護照不見了。", jp:"パスポートをなくしました。", ro:"Pasupooto o nakushimashita."}, 
                        {tw:"我不舒服。", jp:"気分が悪いです。", ro:"Kibun ga warui desu."}, 
                        {tw:"請幫我叫警察。", jp:"警察を呼んでください。", ro:"Keisatsu o yonde kudasai."}
                    ] 
                }
            ];

            // --- COMPUTED ---
            const currentDayData = computed(() => {
                const day = days[selectedDayIndex.value];
                return { ...day, details: itineraryDetails[selectedDayIndex.value] || [] };
            });

            const totalTWD = computed(() => {
                const jpy = walletData.value.reduce((acc, i) => acc + (i.currency==='JPY'?i.amount:0), 0);
                const twd = walletData.value.reduce((acc, i) => acc + (i.currency==='TWD'?i.amount:0), 0);
                return Math.round(twd + jpy * currentRate.value);
            });

            const groupedExpenses = computed(() => {
                const grouped = walletData.value.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = { total: 0, items: [] };
                    acc[item.date].items.push(item);
                    acc[item.date].total += (item.currency === 'JPY' ? item.amount * currentRate.value : item.amount);
                    return acc;
                }, {});
                return grouped;
            });

            // --- WATCHERS ---
            watch(walletData, (newVal) => localStorage.setItem('trip_wallet_vue', JSON.stringify(newVal)), { deep: true });
            watch(currentRate, (newVal) => localStorage.setItem('trip_rate_vue', newVal));
            watch(checkData, (newVal) => localStorage.setItem('trip_check_vue', JSON.stringify(newVal)), { deep: true });

            // --- METHODS ---
            const getNavIcon = (tab) => ({ plan: 'fa-map-location-dot', checklist: 'fa-list-check', wallet: 'fa-wallet', japanese: 'fa-language', info: 'fa-circle-info' }[tab]);
            const getNavLabel = (tab) => ({ plan: '行程', checklist: '清單', wallet: '記帳', japanese: '日語', info: '資訊' }[tab]);
            const getWeatherIcon = (w) => ({ sunny: 'fa-sun', cloudy: 'fa-cloud', rain: 'fa-cloud-showers-heavy', snow: 'fa-snowflake' }[w] || 'fa-cloud');
            const getWeatherDesc = (w) => ({ sunny: '晴朗', cloudy: '多雲', rain: '降雨', snow: '降雪' }[w]);
            const getCategoryColor = (t) => ({ transport: 'bg-slate-400', spot: 'bg-ice-500', food: 'bg-orange-400', shop: 'bg-rose-400' }[t] || 'bg-slate-300');

            const openCalcModal = () => { showCalcModal.value = true; calcExpr.value = ''; tempImg.value = null; calcName.value = ''; };
            const closeCalcModal = () => showCalcModal.value = false;
            
            const pk = (k) => {
                if(k==='C') calcExpr.value = '';
                else if(k==='back') calcExpr.value = calcExpr.value.slice(0, -1);
                else calcExpr.value += k;
            };

            const toggleCurrency = () => currType.value = currType.value === 'JPY' ? 'TWD' : 'JPY';

            const handlePhoto = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const scale = 400 / img.width;
                        canvas.width = 400; canvas.height = img.height * scale;
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        tempImg.value = canvas.toDataURL('image/jpeg', 0.5);
                        
                        // Simulate OCR
                        isScanning.value = true;
                        setTimeout(() => {
                            isScanning.value = false;
                            const mockItems = ["便利商店", "藥妝店", "拉麵", "星巴克"];
                            calcName.value = mockItems[Math.floor(Math.random()*mockItems.length)];
                            calcExpr.value = (Math.floor(Math.random()*5000)+100).toString();
                            alert(`[模擬] 辨識成功！\n品項：${calcName.value}\n金額：${calcExpr.value}`);
                        }, 1500);
                    };
                    img.src = ev.target.result;
                };
                reader.readAsDataURL(file);
            };

            const clearPhoto = () => tempImg.value = null;

            const submitExpense = () => {
                let amount = 0;
                try { amount = Function('"use strict";return (' + calcExpr.value + ')')() || 0; } catch(e) { return; }
                if(amount <= 0) return;
                walletData.value.unshift({ id: Date.now(), date: calcDate.value, name: calcName.value || '未命名', amount, currency: currType.value, img: tempImg.value });
                closeCalcModal();
            };

            const delExpense = (id) => { if(confirm('刪除?')) walletData.value = walletData.value.filter(i => i.id !== id); };
            const showImg = (src) => { 
                const div = document.createElement('div'); 
                div.className = 'fixed inset-0 z-[60] bg-black/90 flex items-center justify-center p-4 backdrop-blur-sm'; 
                div.onclick = () => div.remove(); 
                div.innerHTML = `<img src="${src}" class="max-w-full max-h-[80vh] rounded-lg shadow-2xl">`; 
                document.body.appendChild(div); 
            };

            const openInfoModal = (item) => { modalData.value = { title: item.text, content: item.info, mapKeyword: item.mapKeyword }; showInfoModal.value = true; };
            const closeInfoModal = () => showInfoModal.value = false;
            const speak = (txt) => { if('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(txt); u.lang='ja-JP'; window.speechSynthesis.speak(u); } };
            const formatNumber = (num) => Math.round(num).toLocaleString();
            const saveCheckData = () => { /* Watched */ };
            const saveWalletData = () => { /* Watched */ };

            // Clock
            onMounted(() => {
                setInterval(() => {
                    const now = new Date();
                    twTime.value = now.toLocaleTimeString('en-US',{hour12:false,hour:'2-digit',minute:'2-digit'});
                    jpTime.value = new Date(now.getTime() + (now.getTimezoneOffset()*60000) + (3600000*9)).toLocaleTimeString('en-US',{hour12:false,hour:'2-digit',minute:'2-digit'});
                }, 1000);
            });

            return {
                currentTab, twTime, jpTime, days, selectedDayIndex, currentDayData,
                activeCheckTab, ticketTasks, packingList, shoppingList, checkData, saveCheckData,
                walletData, currentRate, totalTWD, groupedExpenses, showCalcModal, openCalcModal, closeCalcModal,
                calcDate, calcName, calcExpr, currType, tempImg, pk, toggleCurrency, handlePhoto, clearPhoto, submitExpense, delExpense, isScanning,
                jpPhrases, speak,
                showInfoModal, modalData, openInfoModal, closeInfoModal, showImg,
                getNavIcon, getNavLabel, getWeatherIcon, getWeatherDesc, getCategoryColor, formatNumber, saveWalletData
            };
        }
    }).mount('#app');
</script>
</body>
</html>